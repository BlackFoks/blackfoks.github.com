---
layout: post
title: "Как настроить SQL Server 2008 на Virtual Box с доступом по сети"
date: 2011-01-23 16:25
comments: true
categories:
---

Решил перенести все инстансы SQL Server'а на виртуалку, т.к. из-за них довольно
сильно увеличивается время загрузки рабочего компа. В качестве ОС для виртуалки
решил использовать XP, т.к. жрет мало места и оперативки. Поставил XP SP3, после
чего установил SQL Server 2008 Developer. Вместе с ним еще установились .NET 3.5
SP1 и обновление на Windows Installer. Во время установки сервака вылетела
ошибка, что типа не смогли переписать файл, защищаемый виндой, что-то типа
msxml6.dll или как-то так.

Далее запускаю Management Studio, все работает отлично.

Настройка сети
--------------

Теперь надо настроить сеть между хостом (Win7) и гостевой осью. В настройках
адаптеров сети гостевой операционки я выбрал *Сетевой мост* и в качестве
физического адаптера ту сетевую карту, которая у меня подключена к домашней
сети. Это позволит обращаться к базе с любого компа в домашней сети + иметь
доступ в интернет. Вот скрин настроек:

{% img http://s3.amazonaws.com/blackblog/pictures/1/original/guest-net-settings.png Скрин настроек %}

Когда вы выставите такие настройки в свойствах машины и запустите ее, то ХР
после загрузки подключится в домашнюю сеть и получит адрес от DHCP роутера.
Теперь, если попробовать пингануть хост из гостевой ОС, то все пройдет
нормально:

{% gist 791365 %}

Но вот с хоста мы не можем пингануть гостевую ОС, пакеты не доходят:

{% gist 791824 %}

Думаем, в чем проблема и вспоминаем, что в ХР мы не отключили **файервол** и он
блочит пакеты. В гостевой ОС идем в *Панель управления → Сетевые подключения*,
там заходим в свойства сетевого адаптера и отключаем фаейрвол. Теперь еще раз
пингуем гостевую ось с хоста и видим, что все хорошо работает:

{% gist 791825 %}

Настройка удаленного доступа к серверу
--------------------------------------

Сейчас, если мы попробуем подключится к SQL Server'у через Management Studio
хоста, то мы не сможем. Надо настроить удаленный доступ к серверу.

Для этого запускаем Management Studio на гостевой оси, далее заходим в свойства
сервера. Тут надо сделать две вещи:

- На вкладке **Security** выставляем **Server authentication** в *SQL Server and Windows authentication mode*.
- На вкладке **Connections** выбираем пункт *Allow remote connections to this server*.

Теперь идите в *Start → All Programs → Microsoft SQL Server 2008 → Configuration Tools → SQL Server Configuration Manager*.
Там выбирайте *SQL Server Network Configuration → Protocols for MSSQLSERVER*.
Щелкайте дважды по *TCP/IP* и выбирайте следующие опции:

{% img http://s3.amazonaws.com/blackblog/pictures/2/original/tcp-ip-properties.png Настройки TCP IP %}

В поле IP Address укажите адрес хоста.

Все, теперь вы можете удаленно подключаться к Sql Server'у как через Management
Studio, так и с помощью других способов.)

**UPD**. Склонировать витуальный диск можно командой **VBoxManage clonehd**.
